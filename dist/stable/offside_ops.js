'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.offsideOperatorsForBabylon = offsideOperatorsForBabylon;
exports.parseOffsideIndexMap = parseOffsideIndexMap;
function offsideOperatorsForBabylon(tokTypes) {
  const tt = tokTypes;

  const implicitCommaContext = {
    objectLiteral: new Set([tt.star // allow generator defintions with implicit commas
    ]) };

  const at_offside = {
    '::': { tokenPre: tt.braceL, tokenPost: tt.braceR, nestInner: false, codeBlock: true, implicitCommas: false },
    '::@': { tokenPre: tt.parenL, tokenPost: tt.parenR, nestInner: false, extraChars: 1, implicitCommas: false },
    '::()': { tokenPre: tt.parenL, tokenPost: tt.parenR, nestInner: false, extraChars: 2, implicitCommas: false },
    '::{}': { tokenPre: tt.braceL, tokenPost: tt.braceR, nestInner: false, extraChars: 2, implicitCommas: false },
    '::[]': { tokenPre: tt.bracketL, tokenPost: tt.bracketR, nestInner: false, extraChars: 2, implicitCommas: false },

    '@': { tokenPre: tt.parenL, tokenPost: tt.parenR, nestInner: true, keywordBlock: true, implicitCommas: true },
    '@:': { tokenPre: tt.parenL, tokenPost: tt.parenR, nestInner: true, extraChars: 1, nestOp: '\0{,}', implicitCommas: implicitCommaContext.objectLiteral },
    '@#': { tokenPre: tt.parenL, tokenPost: tt.parenR, nestInner: true, extraChars: 1, nestOp: '\0[,]', implicitCommas: true },
    '@()': { tokenPre: tt.braceL, tokenPost: tt.braceR, nestInner: true, extraChars: 2, implicitCommas: true },
    '@{}': { tokenPre: tt.braceL, tokenPost: tt.braceR, nestInner: true, extraChars: 2, implicitCommas: implicitCommaContext.objectLiteral },
    '@[]': { tokenPre: tt.bracketL, tokenPost: tt.bracketR, nestInner: true, extraChars: 2, implicitCommas: true

      // note:  no '@()' -- standardize to use single-char '@ ' instead
    }, keyword_args: { tokenPre: tt.parenL, tokenPost: tt.parenR, nestInner: false, inKeywordArg: true, implicitCommas: false

      // synthetic nestOp delegate operations
    }, '\0{,}': { tokenPre: tt.braceL, tokenPost: tt.braceR, nestInner: false, implicitCommas: implicitCommaContext.objectLiteral },
    '\0[,]': { tokenPre: tt.bracketL, tokenPost: tt.bracketR, nestInner: false, implicitCommas: true } };

  Object.entries(at_offside).forEach(([name, opRec]) => Object.assign(opRec, { name }));
  return at_offside;
}

const rx_offside = /^([ \t]*)(.*)$/mg;
function parseOffsideIndexMap(input) {
  let lines = [null],
      posLastContent = 0,
      last = ['', 0];
  let idx_lastContent = 0;

  input.replace(rx_offside, (match, indent, content, pos) => {
    if (!content) {
      [indent, posLastContent] = last; // blank line; use last valid content as end
    } else {
        // valid content; set last to current indent
        posLastContent = pos + match.length;
        idx_lastContent = lines.length;
        last = [indent, posLastContent];
      }
    lines.push({ line: lines.length, posFirstContent: pos, posLastContent, indent, content });
    return '';
  });

  lines.splice(1 + idx_lastContent); // trim trailing whitespace
  return lines;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2NvZGUvb2Zmc2lkZV9vcHMuanMiXSwibmFtZXMiOlsib2Zmc2lkZU9wZXJhdG9yc0ZvckJhYnlsb24iLCJwYXJzZU9mZnNpZGVJbmRleE1hcCIsInRva1R5cGVzIiwidHQiLCJpbXBsaWNpdENvbW1hQ29udGV4dCIsIm9iamVjdExpdGVyYWwiLCJTZXQiLCJzdGFyIiwiYXRfb2Zmc2lkZSIsInRva2VuUHJlIiwiYnJhY2VMIiwidG9rZW5Qb3N0IiwiYnJhY2VSIiwibmVzdElubmVyIiwiY29kZUJsb2NrIiwiaW1wbGljaXRDb21tYXMiLCJwYXJlbkwiLCJwYXJlblIiLCJleHRyYUNoYXJzIiwiYnJhY2tldEwiLCJicmFja2V0UiIsImtleXdvcmRCbG9jayIsIm5lc3RPcCIsImtleXdvcmRfYXJncyIsImluS2V5d29yZEFyZyIsIk9iamVjdCIsImVudHJpZXMiLCJmb3JFYWNoIiwibmFtZSIsIm9wUmVjIiwiYXNzaWduIiwicnhfb2Zmc2lkZSIsImlucHV0IiwibGluZXMiLCJwb3NMYXN0Q29udGVudCIsImxhc3QiLCJpZHhfbGFzdENvbnRlbnQiLCJyZXBsYWNlIiwibWF0Y2giLCJpbmRlbnQiLCJjb250ZW50IiwicG9zIiwibGVuZ3RoIiwicHVzaCIsImxpbmUiLCJwb3NGaXJzdENvbnRlbnQiLCJzcGxpY2UiXSwibWFwcGluZ3MiOiI7Ozs7O1FBQ2dCQSwwQixHQUFBQSwwQjtRQWtDQUMsb0IsR0FBQUEsb0I7QUFsQ1QsU0FBU0QsMEJBQVQsQ0FBb0NFLFFBQXBDLEVBQThDO0FBQ25ELFFBQU1DLEtBQUtELFFBQVg7O0FBRUEsUUFBTUUsdUJBQXlCO0FBQzdCQyxtQkFBZSxJQUFJQyxHQUFKLENBQVUsQ0FDdkJILEdBQUdJLElBRG9CLENBQ2Y7QUFEZSxLQUFWLENBRGMsRUFBL0I7O0FBSUEsUUFBTUMsYUFBYTtBQUNqQixVQUFRLEVBQUlDLFVBQVVOLEdBQUdPLE1BQWpCLEVBQXlCQyxXQUFXUixHQUFHUyxNQUF2QyxFQUErQ0MsV0FBVyxL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QUNELElBQUQsRUFBekIsQ0FERjtBQUVBLFNBQU9wQixVQUFQO0FBQWlCOztBQUVuQixNQUFNdUIsYUFBYSxrQkFBbkI7QUFDTyxTQUFTOUIsb0JBQVQsQ0FBOEIrQixLQUE5QixFQUFxQztBQUMxQyxNQUFJQyxRQUFRLENBQUMsSUFBRCxDQUFaO0FBQUEsTUFBb0JDLGlCQUFlLENBQW5DO0FBQUEsTUFBc0NDLE9BQUssQ0FBQyxFQUFELEVBQUssQ0FBTCxDQUEzQztBQUNBLE1BQUlDLGtCQUFnQixDQUFwQjs7QUFFQUosUUFBTUssT0FBTixDQUFnQk4sVUFBaEIsRUFBNEIsQ0FBQ08sS0FBRCxFQUFRQyxNQUFSLEVBQWdCQyxPQUFoQixFQUF5QkMsR0FBekIsS0FBaUM7QUFDM0QsUUFBRyxDQUFFRCxPQUFMLEVBQWU7QUFDYixPQUFDRCxNQUFELEVBQVNMLGNBQVQsSUFBMkJDLElBQTNCLENBRGEsQ0FDbUI7QUFBNEMsS0FEOUUsTUFFSztBQUNIO0FBQ0FELHlCQUFpQk8sTUFBTUgsTUFBTUksTUFBN0I7QUFDQU4sMEJBQWtCSCxNQUFNUyxNQUF4QjtBQUNBUCxlQUFPLENBQUNJLE1BQUQsRUFBU0wsY0FBVCxDQUFQO0FBQStCO0FBQ2pDRCxVQUFNVSxJQUFOLENBQWEsRUFBQ0MsTUFBTVgsTUFBTVMsTUFBYixFQUFxQkcsaUJBQWdCSixHQUFyQyxFQUEwQ1AsY0FBMUMsRUFBMERLLE1BQTFELEVBQWtFQyxPQUFsRSxFQUFiO0FBQ0EsV0FBTyxFQUFQO0FBQVMsR0FUWDs7QUFXQVAsUUFBTWEsTUFBTixDQUFhLElBQUVWLGVBQWYsRUFmMEMsQ0FlVjtBQUNoQyxTQUFPSCxLQUFQO0FBQVkiLCJmaWxlIjoib2Zmc2lkZV9vcHMuanMiLCJzb3VyY2VzQ29udGVudCI6WyJcbmV4cG9ydCBmdW5jdGlvbiBvZmZzaWRlT3BlcmF0b3JzRm9yQmFieWxvbih0b2tUeXBlcykgOjpcbiAgY29uc3QgdHQgPSB0b2tUeXBlc1xuXG4gIGNvbnN0IGltcGxpY2l0Q29tbWFDb250ZXh0ID0gQDpcbiAgICBvYmplY3RMaXRlcmFsOiBuZXcgU2V0IEAjXG4gICAgICB0dC5zdGFyIC8vIGFsbG93IGdlbmVyYXRvciBkZWZpbnRpb25zIHdpdGggaW1wbGljaXQgY29tbWFzXG5cbiAgY29uc3QgYXRfb2Zmc2lkZSA9IEB7fVxuICAgICc6Oic6ICAgQHt9IHRva2VuUHJlOiB0dC5icmFjZUwsIHRva2VuUG9zdDogdHQuYnJhY2VSLCBuZXN0SW5uZXI6IGZhbHNlLCBjb2RlQmxvY2s6IHRydWUsIGltcGxpY2l0Q29tbWFzOiBmYWxzZSxcbiAgICAnOjpAJzogIEB7fSB0b2tlblByZTogdHQucGFyZW5MLCB0b2tlblBvc3Q6IHR0LnBhcmVuUiwgbmVzdElubmVyOiBmYWxzZSwgZXh0cmFDaGFyczogMSwgaW1wbGljaXRDb21tYXM6IGZhbHNlLFxuICAgICc6OigpJzogQHt9IHRva2VuUHJlOiB0dC5wYXJlbkwsIHRva2VuUG9zdDogdHQucGFyZW5SLCBuZXN0SW5uZXI6IGZhbHNlLCBleHRyYUNoYXJzOiAyLCBpbXBsaWNpdENvbW1hczogZmFsc2UsXG4gICAgJzo6e30nOiBAe30gdG9rZW5QcmU6IHR0LmJyYWNlTCwgdG9rZW5Qb3N0OiB0dC5icmFjZVIsIG5lc3RJbm5lcjogZmFsc2UsIGV4dHJhQ2hhcnM6IDIsIGltcGxpY2l0Q29tbWFzOiBmYWxzZSxcbiAgICAnOjpbXSc6IEB7fSB0b2tlblByZTogdHQuYnJhY2tldEwsIHRva2VuUG9zdDogdHQuYnJhY2tldFIsIG5lc3RJbm5lcjogZmFsc2UsIGV4dHJhQ2hhcnM6IDIsIGltcGxpY2l0Q29tbWFzOiBmYWxzZSxcblxuICAgICdAJzogICAgQHt9IHRva2VuUHJlOiB0dC5wYXJlbkwsIHRva2VuUG9zdDogdHQucGFyZW5SLCBuZXN0SW5uZXI6IHRydWUsIGtleXdvcmRCbG9jazogdHJ1ZSwgaW1wbGljaXRDb21tYXM6IHRydWUsXG4gICAgJ0A6JzogICBAe30gdG9rZW5QcmU6IHR0LnBhcmVuTCwgdG9rZW5Qb3N0OiB0dC5wYXJlblIsIG5lc3RJbm5lcjogdHJ1ZSwgZXh0cmFDaGFyczogMSwgbmVzdE9wOiAnXFwweyx9JywgaW1wbGljaXRDb21tYXM6IGltcGxpY2l0Q29tbWFDb250ZXh0Lm9iamVjdExpdGVyYWwsXG4gICAgJ0AjJzogICBAe30gdG9rZW5QcmU6IHR0LnBhcmVuTCwgdG9rZW5Qb3N0OiB0dC5wYXJlblIsIG5lc3RJbm5lcjogdHJ1ZSwgZXh0cmFDaGFyczogMSwgbmVzdE9wOiAnXFwwWyxdJywgaW1wbGljaXRDb21tYXM6IHRydWUsXG4gICAgJ0AoKSc6ICBAe30gdG9rZW5QcmU6IHR0LmJyYWNlTCwgdG9rZW5Qb3N0OiB0dC5icmFjZVIsIG5lc3RJbm5lcjogdHJ1ZSwgZXh0cmFDaGFyczogMiwgaW1wbGljaXRDb21tYXM6IHRydWUsXG4gICAgJ0B7fSc6ICBAe30gdG9rZW5QcmU6IHR0LmJyYWNlTCwgdG9rZW5Qb3N0OiB0dC5icmFjZVIsIG5lc3RJbm5lcjogdHJ1ZSwgZXh0cmFDaGFyczogMiwgaW1wbGljaXRDb21tYXM6IGltcGxpY2l0Q29tbWFDb250ZXh0Lm9iamVjdExpdGVyYWwsXG4gICAgJ0BbXSc6ICBAe30gdG9rZW5QcmU6IHR0LmJyYWNrZXRMLCB0b2tlblBvc3Q6IHR0LmJyYWNrZXRSLCBuZXN0SW5uZXI6IHRydWUsIGV4dHJhQ2hhcnM6IDIsIGltcGxpY2l0Q29tbWFzOiB0cnVlLFxuXG4gICAgLy8gbm90ZTogIG5vICdAKCknIC0tIHN0YW5kYXJkaXplIHRvIHVzZSBzaW5nbGUtY2hhciAnQCAnIGluc3RlYWRcbiAgICBrZXl3b3JkX2FyZ3M6IEB7fSB0b2tlblByZTogdHQucGFyZW5MLCB0b2tlblBvc3Q6IHR0LnBhcmVuUiwgbmVzdElubmVyOiBmYWxzZSwgaW5LZXl3b3JkQXJnOiB0cnVlLCBpbXBsaWNpdENvbW1hczogZmFsc2UsXG5cbiAgICAvLyBzeW50aGV0aWMgbmVzdE9wIGRlbGVnYXRlIG9wZXJhdGlvbnNcbiAgICAnXFwweyx9JzogQHt9IHRva2VuUHJlOiB0dC5icmFjZUwsIHRva2VuUG9zdDogdHQuYnJhY2VSLCBuZXN0SW5uZXI6IGZhbHNlLCBpbXBsaWNpdENvbW1hczogaW1wbGljaXRDb21tYUNvbnRleHQub2JqZWN0TGl0ZXJhbCxcbiAgICAnXFwwWyxdJzogQHt9IHRva2VuUHJlOiB0dC5icmFja2V0TCwgdG9rZW5Qb3N0OiB0dC5icmFja2V0UiwgbmVzdElubmVyOiBmYWxzZSwgaW1wbGljaXRDb21tYXM6IHRydWUsXG5cblxuICBPYmplY3QuZW50cmllcyhhdF9vZmZzaWRlKS5mb3JFYWNoIEAgKFtuYW1lLCBvcFJlY10pID0+XG4gICAgT2JqZWN0LmFzc2lnbiBAIG9wUmVjLCBAOiBuYW1lXG4gIHJldHVybiBhdF9vZmZzaWRlXG5cbmNvbnN0IHJ4X29mZnNpZGUgPSAvXihbIFxcdF0qKSguKikkL21nXG5leHBvcnQgZnVuY3Rpb24gcGFyc2VPZmZzaWRlSW5kZXhNYXAoaW5wdXQpIDo6XG4gIGxldCBsaW5lcyA9IFtudWxsXSwgcG9zTGFzdENvbnRlbnQ9MCwgbGFzdD1bJycsIDBdXG4gIGxldCBpZHhfbGFzdENvbnRlbnQ9MFxuXG4gIGlucHV0LnJlcGxhY2UgQCByeF9vZmZzaWRlLCAobWF0Y2gsIGluZGVudCwgY29udGVudCwgcG9zKSA9PiA6OlxuICAgIGlmICEgY29udGVudCA6OlxuICAgICAgW2luZGVudCwgcG9zTGFzdENvbnRlbnRdID0gbGFzdCAvLyBibGFuayBsaW5lOyB1c2UgbGFzdCB2YWxpZCBjb250ZW50IGFzIGVuZFxuICAgIGVsc2UgOjpcbiAgICAgIC8vIHZhbGlkIGNvbnRlbnQ7IHNldCBsYXN0IHRvIGN1cnJlbnQgaW5kZW50XG4gICAgICBwb3NMYXN0Q29udGVudCA9IHBvcyArIG1hdGNoLmxlbmd0aFxuICAgICAgaWR4X2xhc3RDb250ZW50ID0gbGluZXMubGVuZ3RoXG4gICAgICBsYXN0ID0gW2luZGVudCwgcG9zTGFzdENvbnRlbnRdXG4gICAgbGluZXMucHVzaCBAOiBsaW5lOiBsaW5lcy5sZW5ndGgsIHBvc0ZpcnN0Q29udGVudDpwb3MsIHBvc0xhc3RDb250ZW50LCBpbmRlbnQsIGNvbnRlbnRcbiAgICByZXR1cm4gJydcblxuICBsaW5lcy5zcGxpY2UoMStpZHhfbGFzdENvbnRlbnQpIC8vIHRyaW0gdHJhaWxpbmcgd2hpdGVzcGFjZVxuICByZXR1cm4gbGluZXNcblxuIl19