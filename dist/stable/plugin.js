'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = babel_plugin_offside_js;
exports.ensureConsistentBlockIndent = ensureConsistentBlockIndent;
const babel_plugin_id = `babel-plugin-offside--${Date.now()}`;
const default_offsidePluginOpts = {
  check_blocks: /\/node_modules\/|\\node_modules\\/,
  implicit_commas: true };function babel_plugin_offside_js(babel) {
  return {
    name: babel_plugin_id,

    pre(state) {
      this.opts = Object.assign({}, default_offsidePluginOpts, this.opts);

      let check_blocks = this.opts.check_blocks;
      if (check_blocks instanceof Function) {
        check_blocks = check_blocks(state.opts.filename);
      } else if (check_blocks instanceof RegExp) {
        check_blocks = !check_blocks.test(state.opts.filename);
      } else if ('string' === typeof check_blocks) {
        check_blocks = !new RegExp(check_blocks).test(state.opts.filename);
      }

      this.opts.check_blocks = check_blocks = !!check_blocks;
    }

    //, post(state) :: console.dir @ state.ast.program, @{} colors: true, depth: null

    , manipulateOptions(opts, parserOpts) {
      parserOpts.plugins.push('asyncGenerators', 'classProperties', 'decorators', 'functionBind');
      const offsidePluginOpts = opts.plugins.filter(plugin => plugin[0] && babel_plugin_id === plugin[0].key && plugin[1]).map(plugin => plugin[1]).pop();
      parserOpts.offsidePluginOpts = offsidePluginOpts || default_offsidePluginOpts;
    }, visitor: {
      Program(path) {
        if (this.opts.check_blocks) {
          ensureConsistentBlockIndent(path, path.node.body);
        }
      }, BlockStatement(path) {
        if (this.opts.check_blocks) {
          ensureConsistentBlockIndent(path, path.node.body);
        }
      }, SwitchStatement(path) {
        if (this.opts.check_blocks) {
          ensureConsistentBlockIndent(path, path.node.cases);
        }
      }, SwitchCase(path) {
        if (this.opts.check_blocks) {
          ensureConsistentBlockIndent(path, path.node.consequent);
        }
      } } };
}function ensureConsistentBlockIndent(path, body) {
  if (null == body) {
    body = path.node.body;
  }
  body = Array.from(body);
  if (!body || !body.length) {
    return;
  }

  let prev_line,
      block_column = null;
  for (const child of body) {
    const loc = child.loc;
    if (!loc) {
      // A synthetic child often does not have a location.
      // Furthermore, a synthetic child indicates that something is mucking
      // around with the AST. Adapt by resetting block_column and enforcing
      // only across consecutive entries with valid locations.
      block_column = null;
      continue;
    } else if (null === block_column) {
      // assume the first location is indented properlyâ€¦
      block_column = loc.start.column;
    }

    if (loc.start.line != prev_line && loc.start.column != block_column) {
      throw path.hub.file.buildCodeFrameError(child, `Indent mismatch. (block: ${block_column}, statement: ${loc.start.column}). \n` + `    (From 'check_blocks' enforcement option of babel-plugin-offside)`);
    }

    prev_line = loc.end.line;
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2NvZGUvcGx1Z2luLmpzIl0sIm5hbWVzIjpbImJhYmVsX3BsdWdpbl9vZmZzaWRlX2pzIiwiZW5zdXJlQ29uc2lzdGVudEJsb2NrSW5kZW50IiwiYmFiZWxfcGx1Z2luX2lkIiwiRGF0ZSIsIm5vdyIsImRlZmF1bHRfb2Zmc2lkZVBsdWdpbk9wdHMiLCJjaGVja19ibG9ja3MiLCJpbXBsaWNpdF9jb21tYXMiLCJiYWJlbCIsIm5hbWUiLCJwcmUiLCJzdGF0ZSIsIm9wdHMiLCJPYmplY3QiLCJhc3NpZ24iLCJGdW5jdGlvbiIsImZpbGVuYW1lIiwiUmVnRXhwIiwidGVzdCIsIm1hbmlwdWxhdGVPcHRpb25zIiwicGFyc2VyT3B0cyIsInBsdWdpbnMiLCJwdXNoIiwib2Zmc2lkZVBsdWdpbk9wdHMiLCJmaWx0ZXIiLCJwbHVnaW4iLCJrZXkiLCJtYXAiLCJwb3AiLCJ2aXNpdG9yIiwiUHJvZ3JhbSIsInBhdGgiLCJub2RlIiwiYm9keSIsIkJsb2NrU3RhdGVtZW50IiwiU3dpdGNoU3RhdGVtZW50IiwiY2FzZXMiLCJTd2l0Y2hDYXNlIiwiY29uc2VxdWVudCIsIkFycmF5IiwiZnJvbSIsImxlbmd0aCIsInByZXZfbGluZSIsImJsb2NrX2NvbHVtbiIsImNoaWxkIiwibG9jIiwic3RhcnQiLCJjb2x1bW4iLCJsaW5lIiwiaHViIiwiZmlsZSIsImJ1aWxkQ29kZUZyYW1lRXJyb3IiLCJlbmQiXSwibWFwcGluZ3MiOiI7Ozs7O2tCQU13QkEsdUI7UUF5Q1JDLDJCLEdBQUFBLDJCO0FBL0NoQixNQUFNQyxrQkFBbUIseUJBQXdCQyxLQUFLQyxHQUFMLEVBQVcsRUFBNUQ7QUFDQSxNQUFNQyw0QkFBNEI7QUFDOUJDLGdCQUFjLG1DQURnQjtBQUU5QkMsbUJBQWlCLElBRmEsRUFBbEMsQ0FLZSxTQUFTUCx1QkFBVCxDQUFpQ1EsS0FBakMsRUFBd0M7QUFDckQsU0FBUztBQUNMQyxVQUFNUCxlQUREOztBQUdMUSxRQUFJQyxLQUFKLEVBQVc7QUFDVCxXQUFL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QUNBO0FBQ0E7QUFDQTtBQUNBRixxQkFBZSxJQUFmO0FBQ0E7QUFBUSxLQU5WLE1BT0ssSUFBRyxTQUFTQSxZQUFaLEVBQTJCO0FBQzlCO0FBQ0FBLHFCQUFlRSxJQUFJQyxLQUFKLENBQVVDLE1BQXpCO0FBQStCOztBQUVqQyxRQUFHRixJQUFJQyxLQUFKLENBQVVFLElBQVYsSUFBa0JOLFNBQWxCLElBQStCRyxJQUFJQyxLQUFKLENBQVVDLE1BQVYsSUFBb0JKLFlBQXRELEVBQXFFO0FBQ25FLFlBQU1aLEtBQUtrQixHQUFMLENBQVNDLElBQVQsQ0FBY0MsbUJBQWQsQ0FBb0NQLEtBQXBDLEVBQ0gsNEJBQTJCRCxZQUFhLGdCQUFlRSxJQUFJQyxLQUFKLENBQVVDLE1BQU8sT0FBekUsR0FDQyxzRUFGRyxDQUFOO0FBRXdFOztBQUUxRUwsZ0JBQVlHLElBQUlPLEdBQUosQ0FBUUosSUFBcEI7QUFBd0I7QUFBQSIsImZpbGUiOiJwbHVnaW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBiYWJlbF9wbHVnaW5faWQgPSBgYmFiZWwtcGx1Z2luLW9mZnNpZGUtLSR7RGF0ZS5ub3coKX1gXG5jb25zdCBkZWZhdWx0X29mZnNpZGVQbHVnaW5PcHRzID0gQHt9XG4gICAgY2hlY2tfYmxvY2tzOiAvXFwvbm9kZV9tb2R1bGVzXFwvfFxcXFxub2RlX21vZHVsZXNcXFxcL1xuICAsIGltcGxpY2l0X2NvbW1hczogdHJ1ZVxuXG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIGJhYmVsX3BsdWdpbl9vZmZzaWRlX2pzKGJhYmVsKSA6OlxuICByZXR1cm4gQDpcbiAgICAgIG5hbWU6IGJhYmVsX3BsdWdpbl9pZFxuXG4gICAgLCBwcmUoc3RhdGUpIDo6XG4gICAgICAgIHRoaXMub3B0cyA9IE9iamVjdC5hc3NpZ24gQCB7fSwgZGVmYXVsdF9vZmZzaWRlUGx1Z2luT3B0cywgdGhpcy5vcHRzXG5cbiAgICAgICAgbGV0IGNoZWNrX2Jsb2NrcyA9IHRoaXMub3B0cy5jaGVja19ibG9ja3NcbiAgICAgICAgaWYgY2hlY2tfYmxvY2tzIGluc3RhbmNlb2YgRnVuY3Rpb24gOjpcbiAgICAgICAgICBjaGVja19ibG9ja3MgPSBjaGVja19ibG9ja3MgQCBzdGF0ZS5vcHRzLmZpbGVuYW1lXG4gICAgICAgIGVsc2UgaWYgY2hlY2tfYmxvY2tzIGluc3RhbmNlb2YgUmVnRXhwIDo6XG4gICAgICAgICAgY2hlY2tfYmxvY2tzID0gISBjaGVja19ibG9ja3MudGVzdCBAIHN0YXRlLm9wdHMuZmlsZW5hbWVcbiAgICAgICAgZWxzZSBpZiAnc3RyaW5nJyA9PT0gdHlwZW9mIGNoZWNrX2Jsb2NrcyA6OlxuICAgICAgICAgIGNoZWNrX2Jsb2NrcyA9ICEgbmV3IFJlZ0V4cChjaGVja19ibG9ja3MpLnRlc3QgQCBzdGF0ZS5vcHRzLmZpbGVuYW1lXG5cbiAgICAgICAgdGhpcy5vcHRzLmNoZWNrX2Jsb2NrcyA9IGNoZWNrX2Jsb2NrcyA9ICEhIGNoZWNrX2Jsb2Nrc1xuXG4gICAgLy8sIHBvc3Qoc3RhdGUpIDo6IGNvbnNvbGUuZGlyIEAgc3RhdGUuYXN0LnByb2dyYW0sIEB7fSBjb2xvcnM6IHRydWUsIGRlcHRoOiBudWxsXG5cbiAgICAsIG1hbmlwdWxhdGVPcHRpb25zKG9wdHMsIHBhcnNlck9wdHMpIDo6XG4gICAgICAgIHBhcnNlck9wdHMucGx1Z2lucy5wdXNoKCdhc3luY0dlbmVyYXRvcnMnLCAnY2xhc3NQcm9wZXJ0aWVzJywgJ2RlY29yYXRvcnMnLCAnZnVuY3Rpb25CaW5kJylcbiAgICAgICAgY29uc3Qgb2Zmc2lkZVBsdWdpbk9wdHMgPSBvcHRzLnBsdWdpbnNcbiAgICAgICAgICAuZmlsdGVyIEAgcGx1Z2luID0+IHBsdWdpblswXSAmJiBiYWJlbF9wbHVnaW5faWQgPT09IHBsdWdpblswXS5rZXkgJiYgcGx1Z2luWzFdXG4gICAgICAgICAgLm1hcCBAIHBsdWdpbiA9PiBwbHVnaW5bMV1cbiAgICAgICAgICAucG9wKClcbiAgICAgICAgcGFyc2VyT3B0cy5vZmZzaWRlUGx1Z2luT3B0cyA9IG9mZnNpZGVQbHVnaW5PcHRzIHx8IGRlZmF1bHRfb2Zmc2lkZVBsdWdpbk9wdHNcblxuICAgICwgdmlzaXRvcjogOjpcbiAgICAgICAgUHJvZ3JhbShwYXRoKSA6OlxuICAgICAgICAgIGlmIHRoaXMub3B0cy5jaGVja19ibG9ja3MgOjogZW5zdXJlQ29uc2lzdGVudEJsb2NrSW5kZW50KHBhdGgsIHBhdGgubm9kZS5ib2R5KVxuXG4gICAgICAsIEJsb2NrU3RhdGVtZW50KHBhdGgpIDo6XG4gICAgICAgICAgaWYgdGhpcy5vcHRzLmNoZWNrX2Jsb2NrcyA6OiBlbnN1cmVDb25zaXN0ZW50QmxvY2tJbmRlbnQocGF0aCwgcGF0aC5ub2RlLmJvZHkpXG5cbiAgICAgICwgU3dpdGNoU3RhdGVtZW50KHBhdGgpIDo6XG4gICAgICAgICAgaWYgdGhpcy5vcHRzLmNoZWNrX2Jsb2NrcyA6OiBlbnN1cmVDb25zaXN0ZW50QmxvY2tJbmRlbnQocGF0aCwgcGF0aC5ub2RlLmNhc2VzKVxuXG4gICAgICAsIFN3aXRjaENhc2UocGF0aCkgOjpcbiAgICAgICAgICBpZiB0aGlzLm9wdHMuY2hlY2tfYmxvY2tzIDo6IGVuc3VyZUNvbnNpc3RlbnRCbG9ja0luZGVudChwYXRoLCBwYXRoLm5vZGUuY29uc2VxdWVudClcblxuXG5leHBvcnQgZnVuY3Rpb24gZW5zdXJlQ29uc2lzdGVudEJsb2NrSW5kZW50KHBhdGgsIGJvZHkpIDo6XG4gIGlmIG51bGwgPT0gYm9keSA6OiBib2R5ID0gcGF0aC5ub2RlLmJvZHlcbiAgYm9keSA9IEFycmF5LmZyb20oYm9keSlcbiAgaWYgIWJvZHkgfHwgIWJvZHkubGVuZ3RoIDo6IHJldHVyblxuXG4gIGxldCBwcmV2X2xpbmUsIGJsb2NrX2NvbHVtbj1udWxsXG4gIGZvciBjb25zdCBjaGlsZCBvZiBib2R5IDo6XG4gICAgY29uc3QgbG9jID0gY2hpbGQubG9jXG4gICAgaWYgIWxvYyA6OlxuICAgICAgLy8gQSBzeW50aGV0aWMgY2hpbGQgb2Z0ZW4gZG9lcyBub3QgaGF2ZSBhIGxvY2F0aW9uLlxuICAgICAgLy8gRnVydGhlcm1vcmUsIGEgc3ludGhldGljIGNoaWxkIGluZGljYXRlcyB0aGF0IHNvbWV0aGluZyBpcyBtdWNraW5nXG4gICAgICAvLyBhcm91bmQgd2l0aCB0aGUgQVNULiBBZGFwdCBieSByZXNldHRpbmcgYmxvY2tfY29sdW1uIGFuZCBlbmZvcmNpbmdcbiAgICAgIC8vIG9ubHkgYWNyb3NzIGNvbnNlY3V0aXZlIGVudHJpZXMgd2l0aCB2YWxpZCBsb2NhdGlvbnMuXG4gICAgICBibG9ja19jb2x1bW4gPSBudWxsXG4gICAgICBjb250aW51ZVxuICAgIGVsc2UgaWYgbnVsbCA9PT0gYmxvY2tfY29sdW1uIDo6XG4gICAgICAvLyBhc3N1bWUgdGhlIGZpcnN0IGxvY2F0aW9uIGlzIGluZGVudGVkIHByb3Blcmx54oCmXG4gICAgICBibG9ja19jb2x1bW4gPSBsb2Muc3RhcnQuY29sdW1uXG5cbiAgICBpZiBsb2Muc3RhcnQubGluZSAhPSBwcmV2X2xpbmUgJiYgbG9jLnN0YXJ0LmNvbHVtbiAhPSBibG9ja19jb2x1bW4gOjpcbiAgICAgIHRocm93IHBhdGguaHViLmZpbGUuYnVpbGRDb2RlRnJhbWVFcnJvciBAIGNoaWxkLFxuICAgICAgICBgSW5kZW50IG1pc21hdGNoLiAoYmxvY2s6ICR7YmxvY2tfY29sdW1ufSwgc3RhdGVtZW50OiAke2xvYy5zdGFydC5jb2x1bW59KS4gXFxuYCArXG4gICAgICAgIGAgICAgKEZyb20gJ2NoZWNrX2Jsb2NrcycgZW5mb3JjZW1lbnQgb3B0aW9uIG9mIGJhYmVsLXBsdWdpbi1vZmZzaWRlKWBcblxuICAgIHByZXZfbGluZSA9IGxvYy5lbmQubGluZVxuXG4iXX0=