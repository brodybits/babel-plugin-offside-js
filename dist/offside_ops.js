'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.offsideOperatorsForBabylon = offsideOperatorsForBabylon;
exports.parseOffsideIndexMap = parseOffsideIndexMap;
function offsideOperatorsForBabylon(tokTypes) {
  const tt = tokTypes;

  const implicitCommaContext = {
    objectLiteral: new Set([tt.star // allow generator defintions with implicit commas
    ]) };

  const at_offside = {
    '::': { tokenPre: tt.braceL, tokenPost: tt.braceR, nestInner: false, codeBlock: true, implicitCommas: false },
    '::@': { tokenPre: tt.parenL, tokenPost: tt.parenR, nestInner: false, extraChars: 1, implicitCommas: false },
    '::()': { tokenPre: tt.parenL, tokenPost: tt.parenR, nestInner: false, extraChars: 2, implicitCommas: false },
    '::{}': { tokenPre: tt.braceL, tokenPost: tt.braceR, nestInner: false, extraChars: 2, implicitCommas: false },
    '::[]': { tokenPre: tt.bracketL, tokenPost: tt.bracketR, nestInner: false, extraChars: 2, implicitCommas: false },

    '@': { tokenPre: tt.parenL, tokenPost: tt.parenR, nestInner: true, keywordBlock: true, implicitCommas: true },
    '@:': { tokenPre: tt.parenL, tokenPost: tt.parenR, nestInner: true, extraChars: 1, nestOp: '\0{,}', implicitCommas: implicitCommaContext.objectLiteral },
    '@#': { tokenPre: tt.parenL, tokenPost: tt.parenR, nestInner: true, extraChars: 1, nestOp: '\0[,]', implicitCommas: true },
    '@()': { tokenPre: tt.braceL, tokenPost: tt.braceR, nestInner: true, extraChars: 2, implicitCommas: true },
    '@{}': { tokenPre: tt.braceL, tokenPost: tt.braceR, nestInner: true, extraChars: 2, implicitCommas: implicitCommaContext.objectLiteral },
    '@[]': { tokenPre: tt.bracketL, tokenPost: tt.bracketR, nestInner: true, extraChars: 2, implicitCommas: true

      // note:  no '@()' -- standardize to use single-char '@ ' instead
    }, keyword_args: { tokenPre: tt.parenL, tokenPost: tt.parenR, nestInner: false, inKeywordArg: true, implicitCommas: false

      // synthetic nestOp delegate operations
    }, '\0{,}': { tokenPre: tt.braceL, tokenPost: tt.braceR, nestInner: false, implicitCommas: implicitCommaContext.objectLiteral },
    '\0[,]': { tokenPre: tt.bracketL, tokenPost: tt.bracketR, nestInner: false, implicitCommas: true } };

  Object.entries(at_offside).forEach(([name, opRec]) => Object.assign(opRec, { name }));
  return at_offside;
}

const rx_offside = /^([ \t]*)(.*)$/mg;
function parseOffsideIndexMap(input) {
  let lines = [null],
      posLastContent = 0,
      last = ['', 0];
  let idx_lastContent = 0;

  input.replace(rx_offside, (match, indent, content, pos) => {
    if (!content) {
      posLastContent = last;
      indent = false;
    } else {
      // valid content; set last to current indent
      posLastContent = pos + match.length;
      idx_lastContent = lines.length;
      last = posLastContent;
    }
    lines.push({ line: lines.length, posFirstContent: pos, posLastContent, indent, content });
    return '';
  });

  lines.splice(1 + idx_lastContent); // trim trailing whitespace
  return lines;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL2NvZGUvb2Zmc2lkZV9vcHMuanMiXSwibmFtZXMiOlsib2Zmc2lkZU9wZXJhdG9yc0ZvckJhYnlsb24iLCJwYXJzZU9mZnNpZGVJbmRleE1hcCIsInRva1R5cGVzIiwidHQiLCJpbXBsaWNpdENvbW1hQ29udGV4dCIsIm9iamVjdExpdGVyYWwiLCJTZXQiLCJzdGFyIiwiYXRfb2Zmc2lkZSIsInRva2VuUHJlIiwiYnJhY2VMIiwidG9rZW5Qb3N0IiwiYnJhY2VSIiwibmVzdElubmVyIiwiY29kZUJsb2NrIiwiaW1wbGljaXRDb21tYXMiLCJwYXJlbkwiLCJwYXJlblIiLCJleHRyYUNoYXJzIiwiYnJhY2tldEwiLCJicmFja2V0UiIsImtleXdvcmRCbG9jayIsIm5lc3RPcCIsImtleXdvcmRfYXJncyIsImluS2V5d29yZEFyZyIsIk9iamVjdCIsImVudHJpZXMiLCJmb3JFYWNoIiwibmFtZSIsIm9wUmVjIiwiYXNzaWduIiwicnhfb2Zmc2lkZSIsImlucHV0IiwibGluZXMiLCJwb3NMYXN0Q29udGVudCIsImxhc3QiLCJpZHhfbGFzdENvbnRlbnQiLCJyZXBsYWNlIiwibWF0Y2giLCJpbmRlbnQiLCJjb250ZW50IiwicG9zIiwibGVuZ3RoIiwicHVzaCIsImxpbmUiLCJwb3NGaXJzdENvbnRlbnQiLCJzcGxpY2UiXSwibWFwcGluZ3MiOiI7Ozs7O1FBQ2dCQSwwQixHQUFBQSwwQjtRQWtDQUMsb0IsR0FBQUEsb0I7QUFsQ1QsU0FBU0QsMEJBQVQsQ0FBb0NFLFFBQXBDLEVBQThDO0FBQ25ELFFBQU1DLEtBQUtELFFBQVg7O0FBRUEsUUFBTUUsdUJBQXlCO0FBQzdCQyxtQkFBZSxJQUFJQyxHQUFKLENBQVUsQ0FDdkJILEdBQUdJLElBRG9CLENBQ2Y7QUFEZSxLQUFWLENBRGMsRUFBL0I7O0FBSUEsUUFBTUMsYUFBYTtBQUNqQixVQUFRLEVBQUlDLFVBQVVOLEdBQUdPLE1BQWpCLEVBQXlCQyxXQUFXUixHQUFHUyxNQUF2QyxFQUErQ0MsV0FBVyxLQUEx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LElBQUQsRUFBekIsQ0FERjtBQUVBLFNBQU9wQixVQUFQO0FBQWlCOztBQUVuQixNQUFNdUIsYUFBYSxrQkFBbkI7QUFDTyxTQUFTOUIsb0JBQVQsQ0FBOEIrQixLQUE5QixFQUFxQztBQUMxQyxNQUFJQyxRQUFRLENBQUMsSUFBRCxDQUFaO0FBQUEsTUFBb0JDLGlCQUFlLENBQW5DO0FBQUEsTUFBc0NDLE9BQUssQ0FBQyxFQUFELEVBQUssQ0FBTCxDQUEzQztBQUNBLE1BQUlDLGtCQUFnQixDQUFwQjs7QUFFQUosUUFBTUssT0FBTixDQUFnQk4sVUFBaEIsRUFBNEIsQ0FBQ08sS0FBRCxFQUFRQyxNQUFSLEVBQWdCQyxPQUFoQixFQUF5QkMsR0FBekIsS0FBaUM7QUFDM0QsUUFBRyxDQUFFRCxPQUFMLEVBQWU7QUFDYk4sdUJBQWlCQyxJQUFqQjtBQUNBSSxlQUFTLEtBQVQ7QUFBYyxLQUZoQixNQUdLO0FBQ0g7QUFDQUwsdUJBQWlCTyxNQUFNSCxNQUFNSSxNQUE3QjtBQUNBTix3QkFBa0JILE1BQU1TLE1BQXhCO0FBQ0FQLGFBQU9ELGNBQVA7QUFBcUI7QUFDdkJELFVBQU1VLElBQU4sQ0FBYSxFQUFDQyxNQUFNWCxNQUFNUyxNQUFiLEVBQXFCRyxpQkFBZ0JKLEdBQXJDLEVBQTBDUCxjQUExQyxFQUEwREssTUFBMUQsRUFBa0VDLE9BQWxFLEVBQWI7QUFDQSxXQUFPLEVBQVA7QUFBUyxHQVZYOztBQVlBUCxRQUFNYSxNQUFOLENBQWEsSUFBRVYsZUFBZixFQWhCMEMsQ0FnQlY7QUFDaEMsU0FBT0gsS0FBUDtBQUFZIiwiZmlsZSI6Im9mZnNpZGVfb3BzLmpzIiwic291cmNlc0NvbnRlbnQiOlsiXG5leHBvcnQgZnVuY3Rpb24gb2Zmc2lkZU9wZXJhdG9yc0ZvckJhYnlsb24odG9rVHlwZXMpIDo6XG4gIGNvbnN0IHR0ID0gdG9rVHlwZXNcblxuICBjb25zdCBpbXBsaWNpdENvbW1hQ29udGV4dCA9IEA6XG4gICAgb2JqZWN0TGl0ZXJhbDogbmV3IFNldCBAI1xuICAgICAgdHQuc3RhciAvLyBhbGxvdyBnZW5lcmF0b3IgZGVmaW50aW9ucyB3aXRoIGltcGxpY2l0IGNvbW1hc1xuXG4gIGNvbnN0IGF0X29mZnNpZGUgPSBAe31cbiAgICAnOjonOiAgIEB7fSB0b2tlblByZTogdHQuYnJhY2VMLCB0b2tlblBvc3Q6IHR0LmJyYWNlUiwgbmVzdElubmVyOiBmYWxzZSwgY29kZUJsb2NrOiB0cnVlLCBpbXBsaWNpdENvbW1hczogZmFsc2UsXG4gICAgJzo6QCc6ICBAe30gdG9rZW5QcmU6IHR0LnBhcmVuTCwgdG9rZW5Qb3N0OiB0dC5wYXJlblIsIG5lc3RJbm5lcjogZmFsc2UsIGV4dHJhQ2hhcnM6IDEsIGltcGxpY2l0Q29tbWFzOiBmYWxzZSxcbiAgICAnOjooKSc6IEB7fSB0b2tlblByZTogdHQucGFyZW5MLCB0b2tlblBvc3Q6IHR0LnBhcmVuUiwgbmVzdElubmVyOiBmYWxzZSwgZXh0cmFDaGFyczogMiwgaW1wbGljaXRDb21tYXM6IGZhbHNlLFxuICAgICc6Ont9JzogQHt9IHRva2VuUHJlOiB0dC5icmFjZUwsIHRva2VuUG9zdDogdHQuYnJhY2VSLCBuZXN0SW5uZXI6IGZhbHNlLCBleHRyYUNoYXJzOiAyLCBpbXBsaWNpdENvbW1hczogZmFsc2UsXG4gICAgJzo6W10nOiBAe30gdG9rZW5QcmU6IHR0LmJyYWNrZXRMLCB0b2tlblBvc3Q6IHR0LmJyYWNrZXRSLCBuZXN0SW5uZXI6IGZhbHNlLCBleHRyYUNoYXJzOiAyLCBpbXBsaWNpdENvbW1hczogZmFsc2UsXG5cbiAgICAnQCc6ICAgIEB7fSB0b2tlblByZTogdHQucGFyZW5MLCB0b2tlblBvc3Q6IHR0LnBhcmVuUiwgbmVzdElubmVyOiB0cnVlLCBrZXl3b3JkQmxvY2s6IHRydWUsIGltcGxpY2l0Q29tbWFzOiB0cnVlLFxuICAgICdAOic6ICAgQHt9IHRva2VuUHJlOiB0dC5wYXJlbkwsIHRva2VuUG9zdDogdHQucGFyZW5SLCBuZXN0SW5uZXI6IHRydWUsIGV4dHJhQ2hhcnM6IDEsIG5lc3RPcDogJ1xcMHssfScsIGltcGxpY2l0Q29tbWFzOiBpbXBsaWNpdENvbW1hQ29udGV4dC5vYmplY3RMaXRlcmFsLFxuICAgICdAIyc6ICAgQHt9IHRva2VuUHJlOiB0dC5wYXJlbkwsIHRva2VuUG9zdDogdHQucGFyZW5SLCBuZXN0SW5uZXI6IHRydWUsIGV4dHJhQ2hhcnM6IDEsIG5lc3RPcDogJ1xcMFssXScsIGltcGxpY2l0Q29tbWFzOiB0cnVlLFxuICAgICdAKCknOiAgQHt9IHRva2VuUHJlOiB0dC5icmFjZUwsIHRva2VuUG9zdDogdHQuYnJhY2VSLCBuZXN0SW5uZXI6IHRydWUsIGV4dHJhQ2hhcnM6IDIsIGltcGxpY2l0Q29tbWFzOiB0cnVlLFxuICAgICdAe30nOiAgQHt9IHRva2VuUHJlOiB0dC5icmFjZUwsIHRva2VuUG9zdDogdHQuYnJhY2VSLCBuZXN0SW5uZXI6IHRydWUsIGV4dHJhQ2hhcnM6IDIsIGltcGxpY2l0Q29tbWFzOiBpbXBsaWNpdENvbW1hQ29udGV4dC5vYmplY3RMaXRlcmFsLFxuICAgICdAW10nOiAgQHt9IHRva2VuUHJlOiB0dC5icmFja2V0TCwgdG9rZW5Qb3N0OiB0dC5icmFja2V0UiwgbmVzdElubmVyOiB0cnVlLCBleHRyYUNoYXJzOiAyLCBpbXBsaWNpdENvbW1hczogdHJ1ZSxcblxuICAgIC8vIG5vdGU6ICBubyAnQCgpJyAtLSBzdGFuZGFyZGl6ZSB0byB1c2Ugc2luZ2xlLWNoYXIgJ0AgJyBpbnN0ZWFkXG4gICAga2V5d29yZF9hcmdzOiBAe30gdG9rZW5QcmU6IHR0LnBhcmVuTCwgdG9rZW5Qb3N0OiB0dC5wYXJlblIsIG5lc3RJbm5lcjogZmFsc2UsIGluS2V5d29yZEFyZzogdHJ1ZSwgaW1wbGljaXRDb21tYXM6IGZhbHNlLFxuXG4gICAgLy8gc3ludGhldGljIG5lc3RPcCBkZWxlZ2F0ZSBvcGVyYXRpb25zXG4gICAgJ1xcMHssfSc6IEB7fSB0b2tlblByZTogdHQuYnJhY2VMLCB0b2tlblBvc3Q6IHR0LmJyYWNlUiwgbmVzdElubmVyOiBmYWxzZSwgaW1wbGljaXRDb21tYXM6IGltcGxpY2l0Q29tbWFDb250ZXh0Lm9iamVjdExpdGVyYWwsXG4gICAgJ1xcMFssXSc6IEB7fSB0b2tlblByZTogdHQuYnJhY2tldEwsIHRva2VuUG9zdDogdHQuYnJhY2tldFIsIG5lc3RJbm5lcjogZmFsc2UsIGltcGxpY2l0Q29tbWFzOiB0cnVlLFxuXG5cbiAgT2JqZWN0LmVudHJpZXMoYXRfb2Zmc2lkZSkuZm9yRWFjaCBAIChbbmFtZSwgb3BSZWNdKSA9PlxuICAgIE9iamVjdC5hc3NpZ24gQCBvcFJlYywgQDogbmFtZVxuICByZXR1cm4gYXRfb2Zmc2lkZVxuXG5jb25zdCByeF9vZmZzaWRlID0gL14oWyBcXHRdKikoLiopJC9tZ1xuZXhwb3J0IGZ1bmN0aW9uIHBhcnNlT2Zmc2lkZUluZGV4TWFwKGlucHV0KSA6OlxuICBsZXQgbGluZXMgPSBbbnVsbF0sIHBvc0xhc3RDb250ZW50PTAsIGxhc3Q9WycnLCAwXVxuICBsZXQgaWR4X2xhc3RDb250ZW50PTBcblxuICBpbnB1dC5yZXBsYWNlIEAgcnhfb2Zmc2lkZSwgKG1hdGNoLCBpbmRlbnQsIGNvbnRlbnQsIHBvcykgPT4gOjpcbiAgICBpZiAhIGNvbnRlbnQgOjpcbiAgICAgIHBvc0xhc3RDb250ZW50ID0gbGFzdFxuICAgICAgaW5kZW50ID0gZmFsc2VcbiAgICBlbHNlIDo6XG4gICAgICAvLyB2YWxpZCBjb250ZW50OyBzZXQgbGFzdCB0byBjdXJyZW50IGluZGVudFxuICAgICAgcG9zTGFzdENvbnRlbnQgPSBwb3MgKyBtYXRjaC5sZW5ndGhcbiAgICAgIGlkeF9sYXN0Q29udGVudCA9IGxpbmVzLmxlbmd0aFxuICAgICAgbGFzdCA9IHBvc0xhc3RDb250ZW50XG4gICAgbGluZXMucHVzaCBAOiBsaW5lOiBsaW5lcy5sZW5ndGgsIHBvc0ZpcnN0Q29udGVudDpwb3MsIHBvc0xhc3RDb250ZW50LCBpbmRlbnQsIGNvbnRlbnRcbiAgICByZXR1cm4gJydcblxuICBsaW5lcy5zcGxpY2UoMStpZHhfbGFzdENvbnRlbnQpIC8vIHRyaW0gdHJhaWxpbmcgd2hpdGVzcGFjZVxuICByZXR1cm4gbGluZXNcblxuIl19