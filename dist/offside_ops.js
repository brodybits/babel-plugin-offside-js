'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.offsideOperatorsForBabylon = offsideOperatorsForBabylon;
exports.parseOffsideIndexMap = parseOffsideIndexMap;
function offsideOperatorsForBabylon(tokTypes) {
  const tt = tokTypes;
  const at_offside = {
    '::': { tokenPre: tt.braceL, tokenPost: tt.braceR, nestInner: false, codeBlock: true, implicitCommas: false },
    '::@': { tokenPre: tt.parenL, tokenPost: tt.parenR, nestInner: false, extraChars: 1, implicitCommas: false },
    '::()': { tokenPre: tt.parenL, tokenPost: tt.parenR, nestInner: false, extraChars: 2, implicitCommas: false },
    '::{}': { tokenPre: tt.braceL, tokenPost: tt.braceR, nestInner: false, extraChars: 2, implicitCommas: false },
    '::[]': { tokenPre: tt.bracketL, tokenPost: tt.bracketR, nestInner: false, extraChars: 2, implicitCommas: false },

    '@': { tokenPre: tt.parenL, tokenPost: tt.parenR, nestInner: true, keywordBlock: true, implicitCommas: true },
    '@:': { tokenPre: tt.parenL, tokenPost: tt.parenR, nestInner: true, extraChars: 1, nestOp: '\0{,}', implicitCommas: true },
    '@#': { tokenPre: tt.parenL, tokenPost: tt.parenR, nestInner: true, extraChars: 1, nestOp: '\0[,]', implicitCommas: true },
    '@()': { tokenPre: tt.braceL, tokenPost: tt.braceR, nestInner: true, extraChars: 2, implicitCommas: true },
    '@{}': { tokenPre: tt.braceL, tokenPost: tt.braceR, nestInner: true, extraChars: 2, implicitCommas: true },
    '@[]': { tokenPre: tt.bracketL, tokenPost: tt.bracketR, nestInner: true, extraChars: 2, implicitCommas: true

      // note:  no '@()' -- standardize to use single-char '@ ' instead
    }, keyword_args: { tokenPre: tt.parenL, tokenPost: tt.parenR, nestInner: false, inKeywordArg: true, implicitCommas: false

      // synthetic nestOp delegate operations
    }, '\0{,}': { tokenPre: tt.braceL, tokenPost: tt.braceR, nestInner: false, implicitCommas: true },
    '\0[,]': { tokenPre: tt.bracketL, tokenPost: tt.bracketR, nestInner: false, implicitCommas: true } };

  Object.entries(at_offside).forEach(([name, opRec]) => Object.assign(opRec, { name }));
  return at_offside;
}

const rx_offside = /^([ \t]*)(.*)$/mg;
function parseOffsideIndexMap(input) {
  let lines = [null],
      posLastContent = 0,
      last = ['', 0];
  let idx_lastContent = 0;

  input.replace(rx_offside, (match, indent, content, pos) => {
    if (!content) {
      [indent, posLastContent] = last; // blank line; use last valid content as end
    } else {
        // valid content; set last to current indent
        posLastContent = pos + match.length;
        idx_lastContent = lines.length;
        last = [indent, posLastContent];
      }
    lines.push({ line: lines.length, posFirstContent: pos, posLastContent, indent, content });
    return '';
  });

  lines.splice(1 + idx_lastContent); // trim trailing whitespace
  return lines;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL2NvZGUvb2Zmc2lkZV9vcHMuanMiXSwibmFtZXMiOlsib2Zmc2lkZU9wZXJhdG9yc0ZvckJhYnlsb24iLCJwYXJzZU9mZnNpZGVJbmRleE1hcCIsInRva1R5cGVzIiwidHQiLCJhdF9vZmZzaWRlIiwidG9rZW5QcmUiLCJicmFjZUwiLCJ0b2tlblBvc3QiLCJicmFjZVIiLCJuZXN0SW5uZXIiLCJjb2RlQmxvY2siLCJpbXBsaWNpdENvbW1hcyIsInBhcmVuTCIsInBhcmVuUiIsImV4dHJhQ2hhcnMiLCJicmFja2V0TCIsImJyYWNrZXRSIiwia2V5d29yZEJsb2NrIiwibmVzdE9wIiwia2V5d29yZF9hcmdzIiwiaW5LZXl3b3JkQXJnIiwiT2JqZWN0IiwiZW50cmllcyIsImZvckVhY2giLCJuYW1lIiwib3BSZWMiLCJhc3NpZ24iLCJyeF9vZmZzaWRlIiwiaW5wdXQiLCJsaW5lcyIsInBvc0xhc3RDb250ZW50IiwibGFzdCIsImlkeF9sYXN0Q29udGVudCIsInJlcGxhY2UiLCJtYXRjaCIsImluZGVudCIsImNvbnRlbnQiLCJwb3MiLCJsZW5ndGgiLCJwdXNoIiwibGluZSIsInBvc0ZpcnN0Q29udGVudCIsInNwbGljZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7UUFDZ0JBLDBCLEdBQUFBLDBCO1FBNkJBQyxvQixHQUFBQSxvQjtBQTdCVCxTQUFTRCwwQkFBVCxDQUFvQ0UsUUFBcEMsRUFBOEM7QUFDbkQsUUFBTUMsS0FBS0QsUUFBWDtBQUNBLFFBQU1FLGFBQWE7QUFDakIsVUFBUSxFQUFJQyxVQUFVRixHQUFHRyxNQUFqQixFQUF5QkMsV0FBV0osR0FBR0ssTUFBdkMsRUFBK0NDLFdBQVcsS0FBMUQsRUFBaUVDLFdBQVcsSUFBNUUsRUFBa0ZDLGdCQUFnQixLQUFsRyxFQURTO0FBRWpCLFdBQVEsRUFBSU4sVUFBVUYsR0FBR1MsTUFBakIsRUFBeUJMLFdBQVdKLEdBQUdVLE1BQXZDLEVBQStDSixXQUFXLEtBQTFELEVBQWlFSyxZQUFZLENBQTdFLEVBQWdG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QUMsRUFBRCxFQUFLLENBQUwsQ0FBM0M7QUFDQSxNQUFJQyxrQkFBZ0IsQ0FBcEI7O0FBRUFKLFFBQU1LLE9BQU4sQ0FBZ0JOLFVBQWhCLEVBQTRCLENBQUNPLEtBQUQsRUFBUUMsTUFBUixFQUFnQkMsT0FBaEIsRUFBeUJDLEdBQXpCLEtBQWlDO0FBQzNELFFBQUcsQ0FBRUQsT0FBTCxFQUFlO0FBQ2IsT0FBQ0QsTUFBRCxFQUFTTCxjQUFULElBQTJCQyxJQUEzQixDQURhLENBQ21CO0FBQTRDLEtBRDlFLE1BRUs7QUFDSDtBQUNBRCx5QkFBaUJPLE1BQU1ILE1BQU1JLE1BQTdCO0FBQ0FOLDBCQUFrQkgsTUFBTVMsTUFBeEI7QUFDQVAsZUFBTyxDQUFDSSxNQUFELEVBQVNMLGNBQVQsQ0FBUDtBQUErQjtBQUNqQ0QsVUFBTVUsSUFBTixDQUFhLEVBQUNDLE1BQU1YLE1BQU1TLE1BQWIsRUFBcUJHLGlCQUFnQkosR0FBckMsRUFBMENQLGNBQTFDLEVBQTBESyxNQUExRCxFQUFrRUMsT0FBbEUsRUFBYjtBQUNBLFdBQU8sRUFBUDtBQUFTLEdBVFg7O0FBV0FQLFFBQU1hLE1BQU4sQ0FBYSxJQUFFVixlQUFmLEVBZjBDLENBZVY7QUFDaEMsU0FBT0gsS0FBUDtBQUFZIiwiZmlsZSI6Im9mZnNpZGVfb3BzLmpzIiwic291cmNlc0NvbnRlbnQiOlsiXG5leHBvcnQgZnVuY3Rpb24gb2Zmc2lkZU9wZXJhdG9yc0ZvckJhYnlsb24odG9rVHlwZXMpIDo6XG4gIGNvbnN0IHR0ID0gdG9rVHlwZXNcbiAgY29uc3QgYXRfb2Zmc2lkZSA9IEB7fVxuICAgICc6Oic6ICAgQHt9IHRva2VuUHJlOiB0dC5icmFjZUwsIHRva2VuUG9zdDogdHQuYnJhY2VSLCBuZXN0SW5uZXI6IGZhbHNlLCBjb2RlQmxvY2s6IHRydWUsIGltcGxpY2l0Q29tbWFzOiBmYWxzZSxcbiAgICAnOjpAJzogIEB7fSB0b2tlblByZTogdHQucGFyZW5MLCB0b2tlblBvc3Q6IHR0LnBhcmVuUiwgbmVzdElubmVyOiBmYWxzZSwgZXh0cmFDaGFyczogMSwgaW1wbGljaXRDb21tYXM6IGZhbHNlLFxuICAgICc6OigpJzogQHt9IHRva2VuUHJlOiB0dC5wYXJlbkwsIHRva2VuUG9zdDogdHQucGFyZW5SLCBuZXN0SW5uZXI6IGZhbHNlLCBleHRyYUNoYXJzOiAyLCBpbXBsaWNpdENvbW1hczogZmFsc2UsXG4gICAgJzo6e30nOiBAe30gdG9rZW5QcmU6IHR0LmJyYWNlTCwgdG9rZW5Qb3N0OiB0dC5icmFjZVIsIG5lc3RJbm5lcjogZmFsc2UsIGV4dHJhQ2hhcnM6IDIsIGltcGxpY2l0Q29tbWFzOiBmYWxzZSxcbiAgICAnOjpbXSc6IEB7fSB0b2tlblByZTogdHQuYnJhY2tldEwsIHRva2VuUG9zdDogdHQuYnJhY2tldFIsIG5lc3RJbm5lcjogZmFsc2UsIGV4dHJhQ2hhcnM6IDIsIGltcGxpY2l0Q29tbWFzOiBmYWxzZSxcblxuICAgICdAJzogICAgQHt9IHRva2VuUHJlOiB0dC5wYXJlbkwsIHRva2VuUG9zdDogdHQucGFyZW5SLCBuZXN0SW5uZXI6IHRydWUsIGtleXdvcmRCbG9jazogdHJ1ZSwgaW1wbGljaXRDb21tYXM6IHRydWUsXG4gICAgJ0A6JzogICBAe30gdG9rZW5QcmU6IHR0LnBhcmVuTCwgdG9rZW5Qb3N0OiB0dC5wYXJlblIsIG5lc3RJbm5lcjogdHJ1ZSwgZXh0cmFDaGFyczogMSwgbmVzdE9wOiAnXFwweyx9JywgaW1wbGljaXRDb21tYXM6IHRydWUsXG4gICAgJ0AjJzogICBAe30gdG9rZW5QcmU6IHR0LnBhcmVuTCwgdG9rZW5Qb3N0OiB0dC5wYXJlblIsIG5lc3RJbm5lcjogdHJ1ZSwgZXh0cmFDaGFyczogMSwgbmVzdE9wOiAnXFwwWyxdJywgaW1wbGljaXRDb21tYXM6IHRydWUsXG4gICAgJ0AoKSc6ICBAe30gdG9rZW5QcmU6IHR0LmJyYWNlTCwgdG9rZW5Qb3N0OiB0dC5icmFjZVIsIG5lc3RJbm5lcjogdHJ1ZSwgZXh0cmFDaGFyczogMiwgaW1wbGljaXRDb21tYXM6IHRydWUsXG4gICAgJ0B7fSc6ICBAe30gdG9rZW5QcmU6IHR0LmJyYWNlTCwgdG9rZW5Qb3N0OiB0dC5icmFjZVIsIG5lc3RJbm5lcjogdHJ1ZSwgZXh0cmFDaGFyczogMiwgaW1wbGljaXRDb21tYXM6IHRydWUsXG4gICAgJ0BbXSc6ICBAe30gdG9rZW5QcmU6IHR0LmJyYWNrZXRMLCB0b2tlblBvc3Q6IHR0LmJyYWNrZXRSLCBuZXN0SW5uZXI6IHRydWUsIGV4dHJhQ2hhcnM6IDIsIGltcGxpY2l0Q29tbWFzOiB0cnVlLFxuXG4gICAgLy8gbm90ZTogIG5vICdAKCknIC0tIHN0YW5kYXJkaXplIHRvIHVzZSBzaW5nbGUtY2hhciAnQCAnIGluc3RlYWRcbiAgICBrZXl3b3JkX2FyZ3M6IEB7fSB0b2tlblByZTogdHQucGFyZW5MLCB0b2tlblBvc3Q6IHR0LnBhcmVuUiwgbmVzdElubmVyOiBmYWxzZSwgaW5LZXl3b3JkQXJnOiB0cnVlLCBpbXBsaWNpdENvbW1hczogZmFsc2UsXG5cbiAgICAvLyBzeW50aGV0aWMgbmVzdE9wIGRlbGVnYXRlIG9wZXJhdGlvbnNcbiAgICAnXFwweyx9JzogQHt9IHRva2VuUHJlOiB0dC5icmFjZUwsIHRva2VuUG9zdDogdHQuYnJhY2VSLCBuZXN0SW5uZXI6IGZhbHNlLCBpbXBsaWNpdENvbW1hczogdHJ1ZSxcbiAgICAnXFwwWyxdJzogQHt9IHRva2VuUHJlOiB0dC5icmFja2V0TCwgdG9rZW5Qb3N0OiB0dC5icmFja2V0UiwgbmVzdElubmVyOiBmYWxzZSwgaW1wbGljaXRDb21tYXM6IHRydWUsXG5cblxuICBPYmplY3QuZW50cmllcyhhdF9vZmZzaWRlKS5mb3JFYWNoIEAgKFtuYW1lLCBvcFJlY10pID0+XG4gICAgT2JqZWN0LmFzc2lnbiBAIG9wUmVjLCBAOiBuYW1lXG4gIHJldHVybiBhdF9vZmZzaWRlXG5cbmNvbnN0IHJ4X29mZnNpZGUgPSAvXihbIFxcdF0qKSguKikkL21nXG5leHBvcnQgZnVuY3Rpb24gcGFyc2VPZmZzaWRlSW5kZXhNYXAoaW5wdXQpIDo6XG4gIGxldCBsaW5lcyA9IFtudWxsXSwgcG9zTGFzdENvbnRlbnQ9MCwgbGFzdD1bJycsIDBdXG4gIGxldCBpZHhfbGFzdENvbnRlbnQ9MFxuXG4gIGlucHV0LnJlcGxhY2UgQCByeF9vZmZzaWRlLCAobWF0Y2gsIGluZGVudCwgY29udGVudCwgcG9zKSA9PiA6OlxuICAgIGlmICEgY29udGVudCA6OlxuICAgICAgW2luZGVudCwgcG9zTGFzdENvbnRlbnRdID0gbGFzdCAvLyBibGFuayBsaW5lOyB1c2UgbGFzdCB2YWxpZCBjb250ZW50IGFzIGVuZFxuICAgIGVsc2UgOjpcbiAgICAgIC8vIHZhbGlkIGNvbnRlbnQ7IHNldCBsYXN0IHRvIGN1cnJlbnQgaW5kZW50XG4gICAgICBwb3NMYXN0Q29udGVudCA9IHBvcyArIG1hdGNoLmxlbmd0aFxuICAgICAgaWR4X2xhc3RDb250ZW50ID0gbGluZXMubGVuZ3RoXG4gICAgICBsYXN0ID0gW2luZGVudCwgcG9zTGFzdENvbnRlbnRdXG4gICAgbGluZXMucHVzaCBAOiBsaW5lOiBsaW5lcy5sZW5ndGgsIHBvc0ZpcnN0Q29udGVudDpwb3MsIHBvc0xhc3RDb250ZW50LCBpbmRlbnQsIGNvbnRlbnRcbiAgICByZXR1cm4gJydcblxuICBsaW5lcy5zcGxpY2UoMStpZHhfbGFzdENvbnRlbnQpIC8vIHRyaW0gdHJhaWxpbmcgd2hpdGVzcGFjZVxuICByZXR1cm4gbGluZXNcblxuIl19