'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = babel_plugin_offside_js;
exports.ensureConsistentBlockIndent = ensureConsistentBlockIndent;
const babel_plugin_id = `babel-plugin-offside--${Date.now()}`;
const default_offsidePluginOpts = {
  check_blocks: /\/node_modules\/|\\node_modules\\/,
  implicit_commas: true };function babel_plugin_offside_js(babel) {
  return {
    name: babel_plugin_id,

    pre(state) {
      this.opts = Object.assign({}, default_offsidePluginOpts, this.opts);

      let check_blocks = this.opts.check_blocks;
      if (check_blocks instanceof Function) {
        check_blocks = check_blocks(state.opts.filename);
      } else if (check_blocks instanceof RegExp) {
        check_blocks = !check_blocks.test(state.opts.filename);
      } else if ('string' === typeof check_blocks) {
        check_blocks = !new RegExp(check_blocks).test(state.opts.filename);
      }

      this.opts.check_blocks = check_blocks = !!check_blocks;
    }

    //post(state) :: console.dir @ state.ast.program, @{} colors: true, depth: null

    , manipulateOptions(opts, parserOpts) {
      parserOpts.plugins.push('asyncGenerators', 'classProperties', 'decorators', 'functionBind');
      const offsidePluginOpts = opts.plugins.filter(plugin => plugin[0] && babel_plugin_id === plugin[0].key && plugin[1]).map(plugin => plugin[1]).pop();
      parserOpts.offsidePluginOpts = offsidePluginOpts || default_offsidePluginOpts;
    },

    visitor: {
      Program(path) {
        if (this.opts.check_blocks) {
          ensureConsistentBlockIndent(path, path.node.body);
        }
      },

      BlockStatement(path) {
        if (this.opts.check_blocks) {
          ensureConsistentBlockIndent(path, path.node.body);
        }
      },

      SwitchStatement(path) {
        if (this.opts.check_blocks) {
          ensureConsistentBlockIndent(path, path.node.cases);
        }
      },

      SwitchCase(path) {
        if (this.opts.check_blocks) {
          ensureConsistentBlockIndent(path, path.node.consequent);
        }
      } } };
}function ensureConsistentBlockIndent(path, body) {
  if (null == body) {
    body = path.node.body;
  }
  body = Array.from(body);
  if (!body || !body.length) {
    return;
  }

  let prev_line,
      block_column = null;
  for (const child of body) {
    const loc = child.loc;
    if (!loc) {
      // A synthetic child often does not have a location.
      // Furthermore, a synthetic child indicates that something is mucking
      // around with the AST. Adapt by resetting block_column and enforcing
      // only across consecutive entries with valid locations.
      block_column = null;
      continue;
    } else if (null === block_column) {
      // assume the first location is indented properlyâ€¦
      block_column = loc.start.column;
    }

    if (loc.start.line != prev_line && loc.start.column != block_column) {
      throw path.hub.file.buildCodeFrameError(child, `Indent mismatch. (block: ${block_column}, statement: ${loc.start.column}). \n` + `    (From 'check_blocks' enforcement option of babel-plugin-offside)`);
    }

    prev_line = loc.end.line;
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL2NvZGUvcGx1Z2luLmpzIl0sIm5hbWVzIjpbImJhYmVsX3BsdWdpbl9vZmZzaWRlX2pzIiwiZW5zdXJlQ29uc2lzdGVudEJsb2NrSW5kZW50IiwiYmFiZWxfcGx1Z2luX2lkIiwiRGF0ZSIsIm5vdyIsImRlZmF1bHRfb2Zmc2lkZVBsdWdpbk9wdHMiLCJjaGVja19ibG9ja3MiLCJpbXBsaWNpdF9jb21tYXMiLCJiYWJlbCIsIm5hbWUiLCJwcmUiLCJzdGF0ZSIsIm9wdHMiLCJPYmplY3QiLCJhc3NpZ24iLCJGdW5jdGlvbiIsImZpbGVuYW1lIiwiUmVnRXhwIiwidGVzdCIsIm1hbmlwdWxhdGVPcHRpb25zIiwicGFyc2VyT3B0cyIsInBsdWdpbnMiLCJwdXNoIiwib2Zmc2lkZVBsdWdpbk9wdHMiLCJmaWx0ZXIiLCJwbHVnaW4iLCJrZXkiLCJtYXAiLCJwb3AiLCJ2aXNpdG9yIiwiUHJvZ3JhbSIsInBhdGgiLCJub2RlIiwiYm9keSIsIkJsb2NrU3RhdGVtZW50IiwiU3dpdGNoU3RhdGVtZW50IiwiY2FzZXMiLCJTd2l0Y2hDYXNlIiwiY29uc2VxdWVudCIsIkFycmF5IiwiZnJvbSIsImxlbmd0aCIsInByZXZfbGluZSIsImJsb2NrX2NvbHVtbiIsImNoaWxkIiwibG9jIiwic3RhcnQiLCJjb2x1bW4iLCJsaW5lIiwiaHViIiwiZmlsZSIsImJ1aWxkQ29kZUZyYW1lRXJyb3IiLCJlbmQiXSwibWFwcGluZ3MiOiI7Ozs7O2tCQU13QkEsdUI7UUF5Q1JDLDJCLEdBQUFBLDJCO0FBL0NoQixNQUFNQyxrQkFBbUIseUJBQXdCQyxLQUFLQyxHQUFMLEVBQVcsRUFBNUQ7QUFDQSxNQUFNQyw0QkFBNEI7QUFDOUJDLGdCQUFjLG1DQURnQjtBQUU5QkMsbUJBQWlCLElBRmEsRUFBbEMsQ0FLZSxTQUFTUCx1QkFBVCxDQUFpQ1EsS0FBakMsRUFBd0M7QUFDckQsU0FBUztBQUNQQyxVQUFNUCxlQURDOztBQUdQUSxRQUFJQyxLQUFKLEVBQVc7QUFDVCxXQUFLQyxJ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UjtBQUNBO0FBQ0E7QUFDQTtBQUNBRixxQkFBZSxJQUFmO0FBQ0E7QUFBUSxLQU5WLE1BT0ssSUFBRyxTQUFTQSxZQUFaLEVBQTJCO0FBQzlCO0FBQ0FBLHFCQUFlRSxJQUFJQyxLQUFKLENBQVVDLE1BQXpCO0FBQStCOztBQUVqQyxRQUFHRixJQUFJQyxLQUFKLENBQVVFLElBQVYsSUFBa0JOLFNBQWxCLElBQStCRyxJQUFJQyxLQUFKLENBQVVDLE1BQVYsSUFBb0JKLFlBQXRELEVBQXFFO0FBQ25FLFlBQU1aLEtBQUtrQixHQUFMLENBQVNDLElBQVQsQ0FBY0MsbUJBQWQsQ0FBb0NQLEtBQXBDLEVBQ0gsNEJBQTJCRCxZQUFhLGdCQUFlRSxJQUFJQyxLQUFKLENBQVVDLE1BQU8sT0FBekUsR0FDQyxzRUFGRyxDQUFOO0FBRXdFOztBQUUxRUwsZ0JBQVlHLElBQUlPLEdBQUosQ0FBUUosSUFBcEI7QUFBd0I7QUFBQSIsImZpbGUiOiJwbHVnaW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBiYWJlbF9wbHVnaW5faWQgPSBgYmFiZWwtcGx1Z2luLW9mZnNpZGUtLSR7RGF0ZS5ub3coKX1gXG5jb25zdCBkZWZhdWx0X29mZnNpZGVQbHVnaW5PcHRzID0gQHt9XG4gICAgY2hlY2tfYmxvY2tzOiAvXFwvbm9kZV9tb2R1bGVzXFwvfFxcXFxub2RlX21vZHVsZXNcXFxcL1xuICAgIGltcGxpY2l0X2NvbW1hczogdHJ1ZVxuXG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIGJhYmVsX3BsdWdpbl9vZmZzaWRlX2pzKGJhYmVsKSA6OlxuICByZXR1cm4gQDpcbiAgICBuYW1lOiBiYWJlbF9wbHVnaW5faWRcblxuICAgIHByZShzdGF0ZSkgOjpcbiAgICAgIHRoaXMub3B0cyA9IE9iamVjdC5hc3NpZ24gQCB7fSwgZGVmYXVsdF9vZmZzaWRlUGx1Z2luT3B0cywgdGhpcy5vcHRzXG5cbiAgICAgIGxldCBjaGVja19ibG9ja3MgPSB0aGlzLm9wdHMuY2hlY2tfYmxvY2tzXG4gICAgICBpZiBjaGVja19ibG9ja3MgaW5zdGFuY2VvZiBGdW5jdGlvbiA6OlxuICAgICAgICBjaGVja19ibG9ja3MgPSBjaGVja19ibG9ja3MgQCBzdGF0ZS5vcHRzLmZpbGVuYW1lXG4gICAgICBlbHNlIGlmIGNoZWNrX2Jsb2NrcyBpbnN0YW5jZW9mIFJlZ0V4cCA6OlxuICAgICAgICBjaGVja19ibG9ja3MgPSAhIGNoZWNrX2Jsb2Nrcy50ZXN0IEAgc3RhdGUub3B0cy5maWxlbmFtZVxuICAgICAgZWxzZSBpZiAnc3RyaW5nJyA9PT0gdHlwZW9mIGNoZWNrX2Jsb2NrcyA6OlxuICAgICAgICBjaGVja19ibG9ja3MgPSAhIG5ldyBSZWdFeHAoY2hlY2tfYmxvY2tzKS50ZXN0IEAgc3RhdGUub3B0cy5maWxlbmFtZVxuXG4gICAgICB0aGlzLm9wdHMuY2hlY2tfYmxvY2tzID0gY2hlY2tfYmxvY2tzID0gISEgY2hlY2tfYmxvY2tzXG5cbiAgICAvL3Bvc3Qoc3RhdGUpIDo6IGNvbnNvbGUuZGlyIEAgc3RhdGUuYXN0LnByb2dyYW0sIEB7fSBjb2xvcnM6IHRydWUsIGRlcHRoOiBudWxsXG5cbiAgICBtYW5pcHVsYXRlT3B0aW9ucyhvcHRzLCBwYXJzZXJPcHRzKSA6OlxuICAgICAgcGFyc2VyT3B0cy5wbHVnaW5zLnB1c2goJ2FzeW5jR2VuZXJhdG9ycycsICdjbGFzc1Byb3BlcnRpZXMnLCAnZGVjb3JhdG9ycycsICdmdW5jdGlvbkJpbmQnKVxuICAgICAgY29uc3Qgb2Zmc2lkZVBsdWdpbk9wdHMgPSBvcHRzLnBsdWdpbnNcbiAgICAgICAgLmZpbHRlciBAIHBsdWdpbiA9PiBwbHVnaW5bMF0gJiYgYmFiZWxfcGx1Z2luX2lkID09PSBwbHVnaW5bMF0ua2V5ICYmIHBsdWdpblsxXVxuICAgICAgICAubWFwIEAgcGx1Z2luID0+IHBsdWdpblsxXVxuICAgICAgICAucG9wKClcbiAgICAgIHBhcnNlck9wdHMub2Zmc2lkZVBsdWdpbk9wdHMgPSBvZmZzaWRlUGx1Z2luT3B0cyB8fCBkZWZhdWx0X29mZnNpZGVQbHVnaW5PcHRzXG5cbiAgICB2aXNpdG9yOiBAOlxuICAgICAgUHJvZ3JhbShwYXRoKSA6OlxuICAgICAgICBpZiB0aGlzLm9wdHMuY2hlY2tfYmxvY2tzIDo6IGVuc3VyZUNvbnNpc3RlbnRCbG9ja0luZGVudChwYXRoLCBwYXRoLm5vZGUuYm9keSlcblxuICAgICAgQmxvY2tTdGF0ZW1lbnQocGF0aCkgOjpcbiAgICAgICAgaWYgdGhpcy5vcHRzLmNoZWNrX2Jsb2NrcyA6OiBlbnN1cmVDb25zaXN0ZW50QmxvY2tJbmRlbnQocGF0aCwgcGF0aC5ub2RlLmJvZHkpXG5cbiAgICAgIFN3aXRjaFN0YXRlbWVudChwYXRoKSA6OlxuICAgICAgICBpZiB0aGlzLm9wdHMuY2hlY2tfYmxvY2tzIDo6IGVuc3VyZUNvbnNpc3RlbnRCbG9ja0luZGVudChwYXRoLCBwYXRoLm5vZGUuY2FzZXMpXG5cbiAgICAgIFN3aXRjaENhc2UocGF0aCkgOjpcbiAgICAgICAgaWYgdGhpcy5vcHRzLmNoZWNrX2Jsb2NrcyA6OiBlbnN1cmVDb25zaXN0ZW50QmxvY2tJbmRlbnQocGF0aCwgcGF0aC5ub2RlLmNvbnNlcXVlbnQpXG5cblxuZXhwb3J0IGZ1bmN0aW9uIGVuc3VyZUNvbnNpc3RlbnRCbG9ja0luZGVudChwYXRoLCBib2R5KSA6OlxuICBpZiBudWxsID09IGJvZHkgOjogYm9keSA9IHBhdGgubm9kZS5ib2R5XG4gIGJvZHkgPSBBcnJheS5mcm9tKGJvZHkpXG4gIGlmICFib2R5IHx8ICFib2R5Lmxlbmd0aCA6OiByZXR1cm5cblxuICBsZXQgcHJldl9saW5lLCBibG9ja19jb2x1bW49bnVsbFxuICBmb3IgY29uc3QgY2hpbGQgb2YgYm9keSA6OlxuICAgIGNvbnN0IGxvYyA9IGNoaWxkLmxvY1xuICAgIGlmICFsb2MgOjpcbiAgICAgIC8vIEEgc3ludGhldGljIGNoaWxkIG9mdGVuIGRvZXMgbm90IGhhdmUgYSBsb2NhdGlvbi5cbiAgICAgIC8vIEZ1cnRoZXJtb3JlLCBhIHN5bnRoZXRpYyBjaGlsZCBpbmRpY2F0ZXMgdGhhdCBzb21ldGhpbmcgaXMgbXVja2luZ1xuICAgICAgLy8gYXJvdW5kIHdpdGggdGhlIEFTVC4gQWRhcHQgYnkgcmVzZXR0aW5nIGJsb2NrX2NvbHVtbiBhbmQgZW5mb3JjaW5nXG4gICAgICAvLyBvbmx5IGFjcm9zcyBjb25zZWN1dGl2ZSBlbnRyaWVzIHdpdGggdmFsaWQgbG9jYXRpb25zLlxuICAgICAgYmxvY2tfY29sdW1uID0gbnVsbFxuICAgICAgY29udGludWVcbiAgICBlbHNlIGlmIG51bGwgPT09IGJsb2NrX2NvbHVtbiA6OlxuICAgICAgLy8gYXNzdW1lIHRoZSBmaXJzdCBsb2NhdGlvbiBpcyBpbmRlbnRlZCBwcm9wZXJseeKAplxuICAgICAgYmxvY2tfY29sdW1uID0gbG9jLnN0YXJ0LmNvbHVtblxuXG4gICAgaWYgbG9jLnN0YXJ0LmxpbmUgIT0gcHJldl9saW5lICYmIGxvYy5zdGFydC5jb2x1bW4gIT0gYmxvY2tfY29sdW1uIDo6XG4gICAgICB0aHJvdyBwYXRoLmh1Yi5maWxlLmJ1aWxkQ29kZUZyYW1lRXJyb3IgQCBjaGlsZCxcbiAgICAgICAgYEluZGVudCBtaXNtYXRjaC4gKGJsb2NrOiAke2Jsb2NrX2NvbHVtbn0sIHN0YXRlbWVudDogJHtsb2Muc3RhcnQuY29sdW1ufSkuIFxcbmAgK1xuICAgICAgICBgICAgIChGcm9tICdjaGVja19ibG9ja3MnIGVuZm9yY2VtZW50IG9wdGlvbiBvZiBiYWJlbC1wbHVnaW4tb2Zmc2lkZSlgXG5cbiAgICBwcmV2X2xpbmUgPSBsb2MuZW5kLmxpbmVcblxuIl19